.\" Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "LD80 1"
.TH LD80 1 "2016-09-24" "ld80 0.5" " "
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
ld80 \- L80 replacement linker
.SH "SYNOPSYS"
.IX Header "SYNOPSYS"
\&\fBld80\fR \fB\-o\fR \fIoutfile\fR [\fB\-O\fR \fIoformat\fR] [\fB\-W\fR \fIwarns\fR]
[\fB\-s\fR \fIsymfile\fR] [\fB\-S\fR \fIsymsize\fR] [\fB\-cmV\fR] [\fB\-U\fR name]
[\fB\-l\fR] [\fB\-P\fR \fIaddress\fR] [\fB\-D\fR \fIaddress\fR]
[\fB\-E\fR \fIaddress\fR or \fIsymbol\fR]
[\fB\-C\fR \fIname\fR\fB,\fR\fIaddress\fR] \fIobjectfile\fR ...
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBld80\fR is a replacement of the good old M$ L80 linker for \s-1CP/M\s0
and other 8 bit operating systems on Z80/i8080 processor.
\&\fBld80\fR incorporates almost all capabilities of almost L80 and has extra
features. It is intended as part of your Z80 cross development toolbox.
.PP
\&\fBld80\fR accepts object (.REL) files produced with M80 or compatible
assembler (such as zmac) as well as library (.LIB) files made by \s-1LIB80.\s0
.SH "OPTIONS"
.IX Header "OPTIONS"
Addresses below are within the 0000\-FFFF range and are expressed
in hexadecimal notation. Addresses prefixed by percent (%) character
as \f(CW%NNNN\fR are not absolute but the linker is instructed to place
following segments on NNNN-boundary. E.g. \-D%10 causes the
following data segments to be located on paragraph (16 byte) boundary.
.IP "\fB\-o\fR \fIoutfile\fR" 4
.IX Item "-o outfile"
Name of the output file.  Output format will be set as if the file's
suffix were passed to the \fB\-O\fR option.
.IP "\fB\-P\fR \fIaddress\fR" 4
.IX Item "-P address"
\&\fIaddress\fR is the address where code segment of the
following object files will be placed. If an object file specification
is not preceded by \fB\-P\fR option, code segment will be appended to
the previous one. If no \fB\-P\fR option specified before the first
object file, its code segment will be placed to 0000.
.IP "\fB\-D\fR \fIaddress\fR" 4
.IX Item "-D address"
\&\fIaddress\fR is the address where data segment of the
following object files will be placed. If an object file specification
is not preceded by \fB\-D\fR option, data segment will be appended to
the previous one. If no \fB\-D\fR option specified before the first
object file, its data segment will be appended the last code segment.
.IP "\fB\-E\fR \fIaddress\fR or \fIsymbol\fR" 4
.IX Item "-E address or symbol"
Set the entry point of the output to the hexadecimal \fIaddress\fR or
the symbol named \fIname\fR.  Hexadecimal addresses starting with A .. F
must have 0 put in front.
.IP "\fB\-C\fR \fIname\fR,\fIaddress\fR" 4
.IX Item "-C name,address"
\&\fIaddress\fR is the address  where common block \fIname\fR
will be placed. If block name \fIname\fR is empty string or it begins
with space it will be treated as blank common block.
However no extra whitespace character around of comma (,) allowed.
\&\fIname\fR is case insensitive.
Common blocks of unspecified location will be appended to the
last data segment.
.IP "\fB\-U\fR \fIname\fR" 4
.IX Item "-U name"
Common block named \fIname\fR will be \*(L"uncommon\*(R". (This sounds funny,
doesn't it? :\-) Normally common blocks of the same name are to be
located on the same address. However blocks marked as uncommon
will be concatenated like code or data segments. This way you
can spread your code/data over several region of physical memory easy.
\&\fIname\fR is case insensitive.
.IP "\fB\-l\fR" 4
.IX Item "-l"
The following object file is a library. \fBld80\fR will scan the
file and loads modules only that satisfies unresolved external references.
If a new reference to a modules passed earlier found the referenced
module will not be loaded. However you can specify the same library
more than one time in order to resolve backward references.
.IP "\fB\-c\fR" 4
.IX Item "-c"
Suppress data segments. The output file will contain the
the code (and absolute) segments only.
.IP "\fB\-O\fR \fIoformat\fR" 4
.IX Item "-O oformat"
Output format specification. Possible values of \fIoformat\fR are:
.Sp
\&\fBihex\fR or \fBhex\fR: Intel hex. This is the default format.
.Sp
\&\fBbin\fR: Raw binary, gaps filled with X'00'.
.Sp
\&\fBbinff\fR: Raw binary, gaps filled with X'ff'.
.Sp
\&\fBcmd\fR: \s-1TRS\-80 /CMD\s0 file format.
.IP "\fB\-W\fR \fIwarns\fR" 4
.IX Item "-W warns"
Request for warning messages. Possible value of \fIwarns\fR is:
.Sp
\&\fBextchain\fR: Warn if ambigous external reference found. See \*(L"\s-1WARNINGS\*(R"\s0.
.IP "\fB\-s\fR \fIsymfile\fR" 4
.IX Item "-s symfile"
Name of symbol file. `\-' stands for the standard output.
.IP "\fB\-m\fR" 4
.IX Item "-m"
Generate map. List of segment mapping will be placed into symbol file
if it is specified. Otherwise the segment list will printed on standard
output.
.IP "\fB\-S\fR \fIsymsize\fR" 4
.IX Item "-S symsize"
Symbol table size. Use this option if the linker has to process more
than 32768 symbols.
.IP "\fB\-V\fR" 4
.IX Item "-V"
Print version number and exit.
.SH "WARNINGS"
.IX Header "WARNINGS"
The object file format used by L80 is ambigous. References
to the same external symbol are chained. The last element of the chain
is absolute 0000. M80 pruduces the same object file from the
following assembly sources:
.PP
.Vb 6
\&        ;program A                      ;program B
\&        EXTRN   foobar                  EXTRN   foobar
\&        ASEG                            ASEG
\&        ORG     0                       ORG     0
\&        DW      foobar                  DW      0
\&        END                             END
.Ve
.PP
L80 and ld80 cannot figure out what was your intention therefore
always assumes the B version. However ld80 can warn you if this
ambiguity found. Use \fB\-W extchain\fR option to achieve this.
.PP
Placing external reference to location absolute 0000 is possible but
a bit tricky:
.PP
.Vb 6
\&        ;program C
\&        EXTRN   foobar
\&        ASEG
\&        ORG     0
\&        DW      foobar/1        ; forced arithmetic fixup
\&        END
.Ve
.PP
In this case M80 places a newer (and more complicated) item
into the object that can be handle unambigously.
.SH "RESTRICTIONS"
.IX Header "RESTRICTIONS"
\&\fBld80\fR does not process special link item 13 (request library search).
If the linker finds such an item, it prints a warning message and continues
the work.
.PP
Special link item 12 (chan address) is also unimplemented.
This is because the author has never seen this kind of item. :\-)
\&\fBld80\fR will abort if it finds one.
.PP
Extension link item X'35' (\s-1COBOL\s0 overlay segment sentinel) is also
unimplemented due to the same reason. However other extension
link items (known as arithmetic fixups) are fully implemented.
.SH "PORTING"
.IX Header "PORTING"
\&\fBld80\fR is written for and developed on Intel-Linux platform.
It requires some functions of glibc2. It probably could run on big endian
machines without any change, but this was never tested.
.SH "BUGS"
.IX Header "BUGS"
This manual is written in Tarzan-English.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
M$ Utility Software Manual. It can be found on the net as file
\fIm80l80.txt\fR.
.SH "AUTHOR"
.IX Header "AUTHOR"
Ga\*'bor Kiss <kissg@sztaki.hu>
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
This software is copylefted.
.SH "DISCLAIMER"
.IX Header "DISCLAIMER"
.Vb 3
\& This software is in the public domain.
\& This software is distributed with no warranty whatever.
\& The author takes no responsibility for the consequences of its use.
.Ve
